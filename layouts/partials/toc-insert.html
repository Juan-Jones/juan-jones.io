{{ $content := .Content }}
{{ $paragraphs := split $content "</p>" }}
{{ $firstPara := index $paragraphs 0 }}
{{ $remainingContent := delimit (after 1 $paragraphs) "</p>" }}

{{ if .TableOfContents }}
  {{ $firstPara | safeHTML }}
  <div class="post-toc">
    <h2>Table of Contents</h2>
    <div class="toc-content">
      {{ .TableOfContents }}
    </div>
  </div>
  {{ $remainingContent | safeHTML }}
{{ else }}
  {{ .Content }}
{{ end }}
